// New game button
var newGame = document.getElementById('newgame');
var testing = true; // set true to run test code

newGame.onclick = function() {
    var chessBoard = document.getElementById('chessboard');
    newGame.style.display = 'none';
    chessBoard.innerHTML = '<div id="myBoard" style="width: 400px"></div>';

    var board = startGame();
    // Test code which plays out a game which has been hardcoded into this file
    if (testing) {
        // The board state before the first move
        var start_fen = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"; // this a normal starting board
        // The i'th entry of moves corresponds to the boardstate after the i'th move.
        var moves = ['rnbqkbnr/1pppppp1/p6p/8/3PP3/5N2/PPP2PPP/RNBQKB1R b KQkq - 1 1', 'rnbqkbnr/1ppp1pp1/p3p2p/8/3PP3/5N2/PPP2PPP/RNBQKB1R w KQkq - 0 2', 'rnbqkbnr/1ppp1pp1/p3p2p/8/3PP3/3B1N2/PPP2PPP/RNBQK2R b KQkq - 1 2', 'rnbqkbnr/1pp2pp1/p3p2p/3p4/3PP3/3B1N2/PPP2PPP/RNBQK2R w KQkq - 0 3', 'rnbqkbnr/1pp2pp1/p3p2p/3p4/3PP3/3B1N2/PPPN1PPP/R1BQK2R b KQkq - 1 3', 'rnbqkb1r/1pp2pp1/p3pn1p/3p4/3PP3/3B1N2/PPPN1PPP/R1BQK2R w KQkq - 2 4', 'rnbqkb1r/1pp2pp1/p3pn1p/3p4/3PP3/3B1N2/PPPN1PPP/R1BQ1RK1 b kq - 3 4', 'rnbqkb1r/1p3pp1/p3pn1p/2pp4/3PP3/3B1N2/PPPN1PPP/R1BQ1RK1 w kq - 0 5', 'rnbqkb1r/1p3pp1/p3pn1p/2Pp4/4P3/3B1N2/PPPN1PPP/R1BQ1RK1 b kq - 0 5', 'rnbqk2r/1p3pp1/p3pn1p/2bp4/4P3/3B1N2/PPPN1PPP/R1BQ1RK1 w kq - 0 6', 'rnbqk2r/1p3pp1/p3pn1p/2bP4/8/3B1N2/PPPN1PPP/R1BQ1RK1 b kq - 0 6', 'rnbqk2r/1p3pp1/p3p2p/2bn4/8/3B1N2/PPPN1PPP/R1BQ1RK1 w kq - 0 7', 'rnbqk2r/1p3pp1/p3p2p/2bn4/2N5/3B1N2/PPP2PPP/R1BQ1RK1 b kq - 1 7', 'rnbq1rk1/1p3pp1/p3p2p/2bn4/2N5/3B1N2/PPP2PPP/R1BQ1RK1 w - - 2 8', 'rnbq1rk1/1p3pp1/p3p2p/2bn4/P1N5/3B1N2/1PP2PPP/R1BQ1RK1 b - - 0 8', 'rnbq1rk1/1p3pp1/p3p2p/2b5/PnN5/3B1N2/1PP2PPP/R1BQ1RK1 w - - 1 9', 'rnbq1rk1/1p3pp1/p3p2p/2b5/PnN5/3BBN2/1PP2PPP/R2Q1RK1 b - - 2 9', 'rnbq1rk1/1p3pp1/p3p2p/8/PnN5/3BbN2/1PP2PPP/R2Q1RK1 w - - 0 10', 'rnbq1rk1/1p3pp1/p3p2p/8/PnN5/3BPN2/1PP3PP/R2Q1RK1 b - - 0 10', 'r1bq1rk1/1p3pp1/p1n1p2p/8/PnN5/3BPN2/1PP3PP/R2Q1RK1 w - - 1 11', 'r1bq1rk1/1p3pp1/p1n1p2p/8/PnN1B3/4PN2/1PP3PP/R2Q1RK1 b - - 2 11', 'r1b2rk1/1pq2pp1/p1n1p2p/8/PnN1B3/4PN2/1PP3PP/R2Q1RK1 w - - 3 12', 'r1b2rk1/1pq2pp1/p1nQp2p/8/PnN1B3/4PN2/1PP3PP/R4RK1 b - - 4 12', 'r1b2rk1/1p3pp1/p1nqp2p/8/PnN1B3/4PN2/1PP3PP/R4RK1 w - - 0 13', 'r1b2rk1/1p3pp1/p1nNp2p/8/Pn2B3/4PN2/1PP3PP/R4RK1 b - - 0 13', 'r1b2rk1/1p3pp1/p1nNp2p/3n4/P3B3/4PN2/1PP3PP/R4RK1 w - - 1 14', 'r1b2rk1/1p3pp1/p1n1p2p/3n4/P1N1B3/4PN2/1PP3PP/R4RK1 b - - 2 14', '1rb2rk1/1p3pp1/p1n1p2p/3n4/P1N1B3/4PN2/1PP3PP/R4RK1 w - - 3 15', '1rb2rk1/1p3pp1/p1n1p2p/3n4/P1N1B3/4PN2/1PP3PP/R2R2K1 b - - 4 15', '1rb2rk1/1p2npp1/p3p2p/3n4/P1N1B3/4PN2/1PP3PP/R2R2K1 w - - 5 16', '1rb2rk1/1p2npp1/p3p2p/P2n4/2N1B3/4PN2/1PP3PP/R2R2K1 b - - 0 16', '1rb2rk1/1p2npp1/p3pn1p/P7/2N1B3/4PN2/1PP3PP/R2R2K1 w - - 1 17', '1rb2rk1/1p2npp1/p3pn1p/P7/2N5/3BPN2/1PP3PP/R2R2K1 b - - 2 17', '1r3rk1/1p1bnpp1/p3pn1p/P7/2N5/3BPN2/1PP3PP/R2R2K1 w - - 3 18', '1r3rk1/1p1bnpp1/p3pn1p/P3N3/2N5/3BP3/1PP3PP/R2R2K1 b - - 4 18', '1r1r2k1/1p1bnpp1/p3pn1p/P3N3/2N5/3BP3/1PP3PP/R2R2K1 w - - 5 19', '1r1r2k1/1p1bnpp1/p2Npn1p/P3N3/8/3BP3/1PP3PP/R2R2K1 b - - 6 19', '1r1rb1k1/1p2npp1/p2Npn1p/P3N3/8/3BP3/1PP3PP/R2R2K1 w - - 7 20', '1r1rb1k1/1p2npp1/p2Npn1p/P3N3/8/4P3/1PP1B1PP/R2R2K1 b - - 8 20', '1r1rb1k1/1p3pp1/p2Npn1p/P3Nn2/8/4P3/1PP1B1PP/R2R2K1 w - - 9 21', '1r1rN1k1/1p3pp1/p3pn1p/P3Nn2/8/4P3/1PP1B1PP/R2R2K1 b - - 0 21', '1r1rn1k1/1p3pp1/p3p2p/P3Nn2/8/4P3/1PP1B1PP/R2R2K1 w - - 0 22', '1r1rn1k1/1p3pp1/p3p2p/P4n2/2N5/4P3/1PP1B1PP/R2R2K1 b - - 1 22', '1r1rnk2/1p3pp1/p3p2p/P4n2/2N5/4P3/1PP1B1PP/R2R2K1 w - - 2 23', '1r1rnk2/1p3pp1/p3p2p/P4n2/2N3P1/4P3/1PP1B2P/R2R2K1 b - - 0 23', '1r1rnk2/1p3pp1/p2np2p/P7/2N3P1/4P3/1PP1B2P/R2R2K1 w - - 1 24', '1r1rnk2/1p3pp1/pN1np2p/P7/6P1/4P3/1PP1B2P/R2R2K1 b - - 2 24', '1r1rnk2/1p4p1/pN1np2p/P4p2/6P1/4P3/1PP1B2P/R2R2K1 w - - 0 25', '1r1rnk2/1p4p1/pN1np2p/P4P2/8/4P3/1PP1B2P/R2R2K1 b - - 0 25', '1r1rnk2/1p4p1/pN1n3p/P4p2/8/4P3/1PP1B2P/R2R2K1 w - - 0 26', '1r1rnk2/1p4p1/pN1n3p/P4p2/2P5/4P3/1P2B2P/R2R2K1 b - - 0 26', '1r1r1k2/1p4p1/pN1n1n1p/P4p2/2P5/4P3/1P2B2P/R2R2K1 w - - 1 27', '1r1r1k2/1p4p1/pN1n1n1p/P1P2p2/8/4P3/1P2B2P/R2R2K1 b - - 0 27', '1r1r1k2/1p3np1/pN3n1p/P1P2p2/8/4P3/1P2B2P/R2R2K1 w - - 1 28', '1r1r1k2/1p3np1/pNP2n1p/P4p2/8/4P3/1P2B2P/R2R2K1 b - - 0 28', '1r1r1k2/5np1/pNp2n1p/P4p2/8/4P3/1P2B2P/R2R2K1 w - - 0 29', '1r1R1k2/5np1/pNp2n1p/P4p2/8/4P3/1P2B2P/R5K1 b - - 0 29', '3r1k2/5np1/pNp2n1p/P4p2/8/4P3/1P2B2P/R5K1 w - - 0 30', '3r1k2/5np1/BNp2n1p/P4p2/8/4P3/1P5P/R5K1 b - - 0 30', '5k2/5np1/BNp2n1p/P4p2/8/4P3/1P1r3P/R5K1 w - - 1 31', '5k2/5np1/1Np2n1p/P4p2/8/4P3/1P1r3P/R4BK1 b - - 2 31', '5k2/6p1/1Np2n1p/P3np2/8/4P3/1P1r3P/R4BK1 w - - 3 32', '5k2/6p1/1Np2n1p/P3np2/8/4P3/1P1r2BP/R5K1 b - - 4 32', '5k2/6p1/1Np2n1p/P3np2/8/4P3/1r4BP/R5K1 w - - 0 33', '5k2/6p1/PNp2n1p/4np2/8/4P3/1r4BP/R5K1 b - - 0 33', '4nk2/6p1/PNp4p/4np2/8/4P3/1r4BP/R5K1 w - - 1 34', '4nk2/P5p1/1Np4p/4np2/8/4P3/1r4BP/R5K1 b - - 0 34', '5k2/P1n3p1/1Np4p/4np2/8/4P3/1r4BP/R5K1 w - - 1 35', '2N2k2/P1n3p1/2p4p/4np2/8/4P3/1r4BP/R5K1 b - - 2 35', '2N2k2/P1n5/2p3pp/4np2/8/4P3/1r4BP/R5K1 w - - 0 36', '2N2k2/P1n5/2p3pp/4np2/8/4P3/1r4BP/2R3K1 b - - 1 36', '2N2k2/P1n5/2p3pp/4np2/8/4P3/r5BP/2R3K1 w - - 2 37', '2N2k2/P1n5/2B3pp/4np2/8/4P3/r6P/2R3K1 b - - 0 37', '2N2k2/P1n5/2n3pp/5p2/8/4P3/r6P/2R3K1 w - - 0 38', '2N2k2/P1n5/2R3pp/5p2/8/4P3/r6P/6K1 b - - 0 38', '2N2k2/P7/2R3pp/1n3p2/8/4P3/r6P/6K1 w - - 1 39', '2N2k2/P7/5Rpp/1n3p2/8/4P3/r6P/6K1 b - - 2 39', '2N1k3/P7/5Rpp/1n3p2/8/4P3/r6P/6K1 w - - 3 40', '2N1k3/P7/6Rp/1n3p2/8/4P3/r6P/6K1 b - - 0 40', '2N1k3/n7/6Rp/5p2/8/4P3/r6P/6K1 w - - 0 41', '4k3/n7/3N2Rp/5p2/8/4P3/r6P/6K1 b - - 1 41', '8/n2k4/3N2Rp/5p2/8/4P3/r6P/6K1 w - - 2 42', '8/n2k4/6Rp/5N2/8/4P3/r6P/6K1 b - - 0 42', '8/3k4/2n3Rp/5N2/8/4P3/r6P/6K1 w - - 1 43', '8/3k4/2nR3p/5N2/8/4P3/r6P/6K1 b - - 2 43', '8/2k5/2nR3p/5N2/8/4P3/r6P/6K1 w - - 3 44', '8/2k5/2n4p/3R1N2/8/4P3/r6P/6K1 b - - 4 44', '8/2k5/2n5/3R1N1p/8/4P3/r6P/6K1 w - - 0 45', '8/2k5/2n5/3R1N1p/7P/4P3/r7/6K1 b - - 0 45', '8/2k5/8/3R1N1p/1n5P/4P3/r7/6K1 w - - 1 46', '8/2k5/8/1R3N1p/1n5P/4P3/r7/6K1 b - - 2 46', '8/2k5/2n5/1R3N1p/7P/4P3/r7/6K1 w - - 3 47', '8/2k5/2n5/1R5p/7P/4P1N1/r7/6K1 b - - 4 47', '8/8/2nk4/1R5p/7P/4P1N1/r7/6K1 w - - 5 48', '8/8/2nk4/7R/7P/4P1N1/r7/6K1 b - - 0 48', '8/8/3k4/4n2R/7P/4P1N1/r7/6K1 w - - 1 49', '8/8/3k4/4nR2/7P/4P1N1/r7/6K1 b - - 2 49', '8/8/3k4/5R2/6nP/4P1N1/r7/6K1 w - - 3 50', '8/8/3k4/5R2/6nP/4P3/r7/5NK1 b - - 4 50', '8/8/3k4/5R2/6nP/4P3/4r3/5NK1 w - - 5 51', '8/8/3k4/8/6nP/4PR2/4r3/5NK1 b - - 6 51', '8/8/4k3/8/6nP/4PR2/4r3/5NK1 w - - 7 52', '8/8/4k3/7P/6n1/4PR2/4r3/5NK1 b - - 0 52', '8/8/4k3/7P/6n1/4PR2/1r6/5NK1 w - - 1 53', '8/8/4k3/7P/5Rn1/4P3/1r6/5NK1 b - - 2 53', '8/8/4k2n/7P/5R2/4P3/1r6/5NK1 w - - 3 54', '8/8/4k2n/7P/5R2/4P1N1/1r6/6K1 b - - 4 54', '8/8/4k2n/7P/5R2/4P1N1/r7/6K1 w - - 5 55', '8/8/4k2n/7P/1R6/4P1N1/r7/6K1 b - - 6 55', '8/8/7n/3k3P/1R6/4P1N1/r7/6K1 w - - 7 56', '8/8/7n/1R1k3P/8/4P1N1/r7/6K1 b - - 8 56', '8/8/7n/1R5P/2k5/4P1N1/r7/6K1 w - - 9 57', '8/8/1R5n/7P/2k5/4P1N1/r7/6K1 b - - 10 57', '8/8/1R6/7P/2k3n1/4P1N1/r7/6K1 w - - 11 58', '8/8/1R5P/8/2k3n1/4P1N1/r7/6K1 b - - 0 58', '8/8/1R5P/8/2k5/4n1N1/r7/6K1 w - - 0 59', '8/7P/1R6/8/2k5/4n1N1/r7/6K1 b - - 0 59', '8/7P/1R6/8/2k5/4n1N1/8/r5K1 w - - 1 60', '8/7P/1R6/8/2k5/4n1N1/5K2/r7 b - - 2 60', '8/7P/1R6/8/2k3n1/6N1/5K2/r7 w - - 3 61', '8/7P/1R6/8/2k3n1/5KN1/8/r7 b - - 4 61', '8/7P/1R6/4n3/2k5/5KN1/8/r7 w - - 5 62', '8/7P/1R6/4n3/2k2K2/6N1/8/r7 b - - 6 62', '8/7P/1R6/8/2k2K2/3n2N1/8/r7 w - - 7 63', '8/7P/1R6/8/2k5/3nK1N1/8/r7 b - - 8 63', '8/7P/1R6/8/2k5/3nK1N1/8/4r3 w - - 9 64', '8/7P/1R6/8/2k5/3n2N1/3K4/4r3 b - - 10 64', '4r3/7P/1R6/8/2k5/3n2N1/3K4/8 w - - 11 65', '4r3/7P/7R/8/2k5/3n2N1/3K4/8 b - - 12 65', '7r/7P/7R/8/2k5/3n2N1/3K4/8 w - - 13 66', '7r/7P/8/8/2k4R/3n2N1/3K4/8 b - - 14 66', '7r/7P/8/8/2k2n1R/6N1/3K4/8 w - - 15 67', '7r/7P/8/8/2k2n1R/4K1N1/8/8 b - - 16 67', '8/7r/8/8/2k2n1R/4K1N1/8/8 w - - 0 68', '8/7R/8/8/2k2n2/4K1N1/8/8 b - - 0 68', '8/7R/8/3n4/2k5/4K1N1/8/8 w - - 1 69', '8/7R/8/3n4/2k5/5KN1/8/8 b - - 2 69', '8/7R/8/8/2k5/2n2KN1/8/8 w - - 3 70', '8/2R5/8/8/2k5/2n2KN1/8/8 b - - 4 70', '8/2R5/8/8/8/1kn2KN1/8/8 w - - 5 71', '8/2R5/8/8/4N3/1kn2K2/8/8 b - - 6 71', '8/2R5/8/1n6/4N3/1k3K2/8/8 w - - 7 72', '8/8/8/1nR5/4N3/1k3K2/8/8 b - - 8 72', '8/8/8/1nR5/1k2N3/5K2/8/8 w - - 9 73', '8/8/8/1n1R4/1k2N3/5K2/8/8 b - - 10 73', '8/8/8/3R4/1k2N3/n4K2/8/8 w - - 11 74', '8/8/3N4/3R4/1k6/n4K2/8/8 b - - 12 74', '8/8/3N4/3R4/1k6/5K2/2n5/8 w - - 13 75', '8/8/3N4/1R6/1k6/5K2/2n5/8 b - - 14 75', '8/8/3N4/1R6/8/2k2K2/2n5/8 w - - 15 76', '8/8/3N4/1R6/4K3/2k5/2n5/8 b - - 16 76', '8/8/3N4/1R6/1n2K3/2k5/8/8 w - - 17 77', '8/8/3N4/2R5/1n2K3/2k5/8/8 b - - 18 77', '8/8/3N4/2R5/1n2K3/1k6/8/8 w - - 19 78', '8/8/8/1NR5/1n2K3/1k6/8/8 b - - 20 78', '8/8/8/1NR5/4K3/1k6/n7/8 w - - 21 79', '8/8/8/1NR5/8/1k1K4/n7/8 b - - 22 79', '8/8/8/1NR5/1k6/3K4/n7/8 w - - 23 80', '8/8/8/1N6/1k6/3K4/n1R5/8 b - - 24 80', '8/8/8/1N6/1k6/3K4/2R5/2n5 w - - 25 81', '8/8/8/1N6/1k6/3K4/8/2R5 b - - 0 81', '8/8/8/1k6/8/3K4/8/2R5 w - - 0 82', '8/8/8/1k6/3K4/8/8/2R5 b - - 1 82', '8/8/1k6/8/3K4/8/8/2R5 w - - 2 83', '8/8/1k6/3K4/8/8/8/2R5 b - - 3 83', '8/8/8/k2K4/8/8/8/2R5 w - - 4 84', '8/8/8/k1K5/8/8/8/2R5 b - - 5 84', '8/8/k7/2K5/8/8/8/2R5 w - - 6 85', '8/8/k1K5/8/8/8/8/2R5 b - - 7 85', '8/k7/2K5/8/8/8/8/2R5 w - - 8 86', '8/k7/2K5/8/8/8/8/R7 b - - 9 86', '1k6/8/2K5/8/8/8/8/R7 w - - 10 87', '1k6/8/R1K5/8/8/8/8/8 b - - 11 87', '2k5/8/R1K5/8/8/8/8/8 w - - 12 88', 'R1k5/8/2K5/8/8/8/8/8 b - - 13 88'];
        board.start(false);
        playoutGame(board, moves);
    }
};

function startGame() {
    var board = Chessboard('myBoard', {
        draggable: true,
        dropOffBoard: 'trash',
        sparePieces: true
    })

    return board;
}

// Returns a Promise that resolves after "ms" Milliseconds
const timer = ms => new Promise(res => setTimeout(res, ms))

// Function needs to be asynchronus so that await works
async function playoutGame(board, moves) {
    for (var i = 0; i < moves.length; i++) {
        board.position(moves[i]);  // Apply i'th move
        await timer(500);          // Wait for 500ms so the game doesn't play out too fast 
        console.log(positions[i], moves[i]);  // See a history of boardstates/moves in the console
    }
}